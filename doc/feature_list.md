
# 対戦型タワーディフェンス プログラムイベント 機能一覧（2025年10月最新版）

## 1. ゲーム基本仕様
- 純ES Modules・ブラウザ実行型。自軍/敵軍とも最大10ユニット、10種類のJOBから編成。
- マップは左右陣地・中央通路・壁・城（耐久値あり）で構成。
- 勝利条件：敵城の破壊。引き分け判定あり。
- ローカルPCで完結。通信・サーバー不要。
- ターン制（1ターン=全ユニットAIコマンド実行）。

## 2. ディレクトリ・ファイル構成
- `src/teams/east|west/unit01.js〜unit10.js`：AIユニットファイル（学生作成）
- `src/data/jobs.js`：JOB定義（ステータス・スキル）
- `src/data/map.js`：マップ定義（サイズ・壁・城座標）
- `src/config/team-map.json`：チーム編成・初期配置
- `src/config/asset-manifest.json`：画像アセット一覧
- `src/assets/audio/audio-manifest.json`：音声アセット一覧
- `src/engine/`：ゲーム進行・ルール・状態管理
- `src/render/`：描画・UI・エフェクト
- `src/sdk/`：API・サンドボックス・バリデータ
- `src/shared/`：座標計算・ユニット操作ユーティリティ

## 3. ユニットAI仕様
- 1ユニット=1ファイル。`init`（初期化）、`moveTo`（移動）、`attack`（攻撃）、`update`（行動決定）等を実装。
- `init`でJOB・初期配置・ボーナス・表示名・メモリを返却。
- `moveTo`/`attack`/`update`は毎ターン呼ばれ、コマンドを返す。
- SDKの`actions`/`utils`/`state.memory`を利用可能。
- ボーナス合計10超過はバリデータで除外。

## 4. JOB・スキルシステム
- 10種類のJOB（ソルジャー、ランサー、アーチャー、メイジ、ヒーラー、ガーディアン、アサシン、エンジニア、サモナー、スカウト、相撲、モンスター）。
- 各JOBはHP/攻撃/防御/速度/射程/視界/スキルを持つ。
- スキルは1試合1回のみ発動（doSkillで効果・エフェクト）。
- JOB定義は`jobs.js`で管理、バランス調整可能。

## 5. マップ・オブジェクト仕様
- マップサイズ・壁・城座標は`map.js`で定義。
- 壁は耐久値を持ち、破壊可能。城はHP・座標を持つ。
- 初期配置は自軍陣地20マス以内、重複不可。

## 6. シミュレーションエンジン
- `game-engine.js`で進行管理。`actions.js`で行動解決。
- 行動順は速度降順→スロット昇順。
- 移動は壁・混雑判定、攻撃は射程・ダメージ計算。
- スキルはジョブごとのdoSkillで処理。
- エフェクトは`queueEffect`で登録、描画・音声再生。
- 勝敗判定は城HP0で終了。

## 7. ユーザーインターフェース
- Canvas描画（`renderer.js`）、サイドパネル（`ui-overlay.js`）、操作UI（`controls.js`）。
- ユニットクリックで詳細表示（JOB・HP・座標・ボーナス後ステータス）。
- 再生/停止/ステップ/速度変更、ログ表示。

## 8. SDK・安全対策
- `sdk/api.js`：AI用API（actions, utils, memory等）
- `sdk/sandbox.js`：危険API禁止、ホワイトリストimportのみ許可。
- `sdk/validator.js`：ファイル検証・警告（ボーナス超過・配置重複・未定義JOB等）。

## 9. アセット管理
- 画像は`assets/images/`、音声は`assets/audio/`に用途別格納。
- `asset-manifest.json`/`audio-manifest.json`で一覧管理。
- 画像：城、JOB、マップ、エフェクト、UI等。
- 音声：BGM、SE、ジョブ固有サウンド。

## 10. ログ・リプレイ
- ターン毎のログはブラウザ内メモリに保持、オーバーレイ表示。
- 攻撃・スキル・移動失敗・城/壁ダメージ・エラー・警告等を記録。
- リプレイ記録（`ReplayRecorder`）は未実装。

## 11. 運営・大会機能
- チーム編成は`team-map.json`編集・ファイルコピーで完了。
- 乱数シード入力UI、整合テスト、評価指標出力（城ダメージ・撃破数等）。
- トーナメント自動進行・結果集計・ランキング生成（オプション）。

## 12. ドキュメント
- ルールブック、APIリファレンス、JOB仕様書、サンプル戦略、FAQ、トラブルシューティング。
- 共通で利用可能な定数・ユーティリティを提供するSDKモジュールを用意。
- 行動可能コマンド：移動、攻撃、スキル使用、防御、待機など。
- 行動決定で参照可能な情報：視界範囲内の敵味方、壁・城の状態、自ユニットのHP/MPなど。
- 不正行為防止のため、想定外のモジュール読み込みやI/Oを制限するサンドボックス実行環境を実装。

## 3. JOBシステム
- 10種類のJOBテンプレートを提供（例：ソルジャー、ランサー、アーチャー、メイジ、ヒーラー、ガーディアン、アサシン、エンジニア、サモナー、スカウト）。
- 各JOBは基礎ステータス（HP、攻撃力、移動速度、防御力、射程、スキル）を持つ。
- スキルにはクールダウンやコストを設定し、`update` 内で使用可能。
- ユニット作成時にJOBを指定し、プログラムファイル名と紐付け。
- バランス調整用にJOB定義を外部JSONで管理。

## 4. マップ・オブジェクト仕様
- マップサイズ、通路幅、壁耐久値などを設定ファイルで定義。
- 壁破壊によって通路幅が変化する演出。
- 城は耐久値の他にシールドなど特殊要素を設定可能。
- 地形効果（移動速度低下ゾーン、攻撃強化エリア等）の導入を検討。

## 5. シミュレーションエンジン
- 各ステップでユニット行動を評価し、同時行動解決ルールを定義（優先度や行動キュー）。
- 当たり判定、射程判定、スキル効果適用の処理を実装。
- ランダム要素は乱数シード固定でリプレイ可能にする。
- ログ生成（テキスト・JSON）とリプレイ再生機能を提供。

## 6. ユーザーインターフェース
- 試合進行の可視化（CanvasまたはDOMベース）を提供。
- 再生速度変更、一時停止、ステップ進行などの操作。
- ユニット情報ポップアップ、HPバー、ログ閲覧UI。

## 7. 開発サポート
- 雛形ユニットコードとチュートリアル資料。
- ローカルテスト用CLI：指定した2チームのAIを読み込み対戦。
- デバッグモード：視界表示、攻撃判定表示、内部状態ダンプ。
- 自動テストスクリプト：ユニットファイルの構文チェック、API準拠チェック。

## 8. 大会運営機能（オプション）
- トーナメント自動進行スクリプト。
- 試合結果集計とランキング生成。
- ベンチマーク用AI（標準AI）との対戦機能。

## 9. ドキュメント
- ルールブック、APIリファレンス、JOB仕様書。
- サンプル戦略とAIの実装例。
- トラブルシューティングガイドとFAQ。